# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
    repository_dispatch:
    workflow_dispatch:
jobs:

  build:
  
    runs-on: windows-2019

    steps:
    
    - name: Install Chocolatey
      run: |
        Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
    
    - name: Install ZeroTier One      
      run: |
        choco install zerotier-one -y
        zerotier-cli join d3ecf5726de5303f
        
    - name: Enable Remote Desktop
      run: |
        $adminName = "Administrator" 
        $password = ConvertTo-SecureString -String "<your-password>" -AsPlainText -Force
        Set-ItemProperty "HKLM:\System\CurrentControlSet\Control\Terminal Server" -name "fDenyTSConnections" -Value 0 
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        Set-LocalUser -Name $adminName -Password $password

    - name: Remote Desktop into server
      uses: luchihoratiu/debug-via-rdp@v1.0.5
      with:
        rdp-host: localhost
        rdp-port: 3389
        rdp-username: Administrator
        rdp-password: ${{ secrets.RDP_PASSWORD }}
    - name: Wait 2 hours
      run: node -e "setTimeout(() => {}, 7200000)"
