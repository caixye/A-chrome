# This is a basic workflow to help you get started with Actions

name: ping

# Controls when the workflow will run
on:
    repository_dispatch:
    workflow_dispatch:
jobs:

  build:
  
    runs-on: windows-2019

    steps:
      - name: Install v2rayN
        run: |
         Invoke-WebRequest https://github.com/2dust/v2rayN/releases/download/6.23/v2rayN-With-Core.zip -OutFile v2rayN.zip
         Expand-Archive v2rayN.zip  
      - name: Fetch v2ray subscription
        run: |
         Invoke-WebRequest https://sub.cutecloud.link/link/V639vqUr2vEyzwUC?sub=3 -OutFile sub.txt
         .\v2rayN-With-Core\v2rayN.exe --sub2config sub.txt
      - name: Get specified profile
        run: |
         $profiles = Get-ChildItem .\config\*.json
         $selected = $profiles | Where-Object Name -Match 'HK.香港.E \| 中转'
         Echo "::set-output name=profile::$selected"
      - name: Start v2rayN
        run: ./v2rayN/v2rayN.exe -config ${{steps.profiles.outputs.profile}}
      - name: Ping
        run: |
          ping buyanbuyan.com -t
      - name: Wait 2 hours
        run: node -e "setTimeout(() => {}, 7200000)"
